<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xml:space="preserve"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>xqDoc -- Module</title><script language="JavaScript"><!--
        function popUp(URL) {
                 day = new Date();
                 id = day.getTime();
                 eval("page = window.open(URL, 'xqdoccode', 'toolbar=0,scrollbars=1,location=0,statusbar=0,menubar=0,resizable=1,width=600,height=400,left = 412,top = 334');")
                 page.focus();
        }
      --></script><script language="JavaScript"><!--
	    function litePopUp(str) {    
  		  OpenWindow=window.open('', 'xqdoccode', 'toolbar=0,scrollbars=1,location=0,statusbar=0,menubar=0,resizable=1,width=600,height=400,left = 412,top = 334');
  		  OpenWindow.document.write('<html xmlspace="preserve">');
  		  OpenWindow.document.write('<head>');
  		  OpenWindow.document.write('<title>xqDoc - Code Sample</title>');
  		  OpenWindow.document.write('</head>');  		    		    		  
  		  OpenWindow.document.write('<body xml:space="preserve">');
  		  OpenWindow.document.write('<pre>');
 		  OpenWindow.document.write(str);
 		  OpenWindow.document.write('</pre>');
  		  OpenWindow.document.write('</body>');
  		  OpenWindow.document.write('</html>');
  		  OpenWindow.document.close();
  		  page.focus();
        }
      --></script><style><!--
body		{
		font: 80% Verdana;
		}
table		{
		font-size: 100%;
		}
h1, h2, h3, h4, h5, h6
		{
		clear: both;
		float: none;
		}
h1		{
		font-size: 100%;
		margin: 0em;
		}
h2		{
		font-size: 180%;
		margin-bottom: -1em;
		margin-top: .3em;
		}
h3		{
		font-size: 150%;
		}	
h4		{
		font-size: 140%;
		background-color: #ccf;
		border-bottom: 1px solid #99f;
		width: 100%;
		}
h5		{
		margin: 1em 0em 0em 0em;
		font-size: 120%;
		}
h6		{
		margin: 0em 0em 0em 3em;
		font-style: italic;
		font: bold italic;
		font-size: 100%;
		}
#variables, #methods, #methoddetail
		{
		padding-left: 3em;
		margin-bottom: 1.4em;
		clear: both;
		float: none;
		}
#methods ul.method, #variables ul.method
		{
		margin: 1em 0em 0em;
		}
#methoddetail ul.method
		{
		margin: 0em;
		}
div.inexternal
		{
		padding-left: 2em;
		margin-bottom: 1em;
		}
div.methoddetail p
		{
		float: none;
		clear: both;
		padding-left: 2em;
		margin-bottom: 1em;
		}
div.methoddetail{
		padding-bottom: 1em;
		}
div.methoddetail li
		{
		list-style-type: none;
		font-weight: bold;
		}
div.methoddetail li li
		{
		list-style-type: circle;
		font-weight: normal;
		}
div.methoddetail li ul
		{
		padding-bottom: 0.5em;
		font-weight: normal;
		}
table.inexternal{
		clear: both;
		float: none;
		width: 80%;
		margin-left: 3em;
		padding: 0em;
		
		}
table.inexternal th
		{
		background-color:#dedede;
		width: 50%;
		}			
td		{
		vertical-align: top;
		}
div.description {
		margin-top: .5em;
		font-weight: normal;
		padding-left: 1em;
		}
ul.method	{
		clear: both;
		float: none;
		width: 90%;
		list-style-type: none;
		border-top: 1px solid #ccc;
		}
ul.method li.left
		{
		float: left;
		clear: none;
		width: 40%;
		font-weight: bold;
		margin-bottom: 2em;
		}
ul.method li.right
		{
		position: relative;
            top: 0em;
		float: left;
            width: 55%;
		margin-bottom: 2em;
		padding-left: 2em;
		}
div.home 	{
		width: 60%;
		float: left;
		margin-right: 1%;
		border: 1px
		}
div.home h4	{
		font-size: 120%;
		background-color: #fff;
		border-bottom: 1px solid #99f;
		width: 100%;
		margin-bottom: -1em;
		}
div.overview p {
               width: 60%;
               }
     
 --></style></head><body><h4>Module URI</h4><h1>http://dda.dk/ddi/urn</h1><h4>Module Description</h4><p> This module contains the functions used to find DDI elements by URN. The entry function for this module is <b xmlns:xqdoc="http://www.xqdoc.org/1.0"> urn:resolveUrn</b>.<br xmlns:xqdoc="http://www.xqdoc.org/1.0">  The rest of the functions are local and cannot be used externally. </p><ul></ul>&nbsp; &nbsp;<h4>Function Summary</h4><div id="methods"><a name="methods"></a><ul class="method"><li class="left"><a href="#findVersion">findVersion</a><div class="description"> Returns the nearest version for the given element.</div></li><li class="right">( $element as element()) as xs:string?<br><br></li></ul><ul class="method"><li class="left"><a href="#getStudyVersions">getStudyVersions</a><div class="description"> Returns a list of LightXmlObject element containing the existing versions of a study.</div></li><li class="right">( $studyId as xs:string) as element()?<br><br></li></ul><ul class="method"><li class="left"><a href="#resolveUrn">resolveUrn</a><div class="description"> Returns the DDI element specified by an ID and version</div></li><li class="right">( $urn as xs:string) as node()?<br><br></li></ul></div>&nbsp;<h4>Function Detail</h4><div id="methoddetail"><div id="findVersion" class="methoddetail"><h5><a name="findVersion"></a>findVersion</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:findVersion($element as element()) as xs:string?{<br/&gt;    if ($element/@version) then<br/&gt;        $element/@version<br/&gt;    else<br/&gt;        let $parent := $element/..<br/&gt;        return if ($parent) then<br/&gt;            local:findVersion($parent)<br/&gt;        else ()<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $element as element()) as xs:string?<br><br></li></ul><p> Returns the nearest version for the given element. It checks if the element itself has an 'version' attribute and if so it returns that attribute. If the element does not have that attribute the function calls itself recursively until a version attribute is found or until we have reached the root element.</p><ul><li>Parameters:</li><ul><li>$element - the element for which we want to find the version<br></li></ul></ul></div>&nbsp;<div id="getStudyVersions" class="methoddetail"><h5><a name="getStudyVersions"></a>getStudyVersions</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function urn:getStudyVersions($studyId as xs:string) as element()?{<br/&gt;    &amp;lt;dl:LightXmlObjectList xmlns:dl=&#34;ddieditor-lightobject&#34;<br/&gt;        xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;<br/&gt;        xsi:schemaLocation=&#34;ddieditor-lightobject ddieditor-lightxmlobject.xsd&#34;<br/&gt;        xmlns:rmd=&#34;http://dda.dk/ddi/result-metadata&#34;&amp;gt;<br/&gt;        {<br/&gt;        let $study := collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(@id, $studyId)]<br/&gt;        return &amp;lt;LightXmlObject element=&#34;main-db&#34; id=&#34;{data($study/@id)}&#34; version=&#34;{data($study/@version)}&#34; /&amp;gt;,<br/&gt;        for $study in collection(&amp;apos;/db/apps/dda-urn&amp;apos;)//su:StudyUnit[ft:query(@id, $studyId)]<br/&gt;            return &amp;lt;LightXmlObject element=&#34;urn-db&#34; id=&#34;{data($study/@id)}&#34; version=&#34;{data($study/@version)}&#34; /&amp;gt;<br/&gt;        }<br/&gt;    &amp;lt;/dl:LightXmlObjectList&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $studyId as xs:string) as element()?<br><br></li></ul><p> Returns a list of LightXmlObject element containing the existing versions of a study. It looks both in the main database and the URN database and returns all found versions for the given study. The result 'id' attribute of the LightXmlObject object contains the study ID, the 'version' attribute contains the version and the 'element' attribute contains main-db|urn-db spedifying in which database the result was found.</p><ul><li>Parameters:</li><ul><li>$studyId - the ID of the study<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="2">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr><tr><td>data</td></tr></table></div></div>&nbsp;<div id="resolveUrn" class="methoddetail"><h5><a name="resolveUrn"></a>resolveUrn</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function urn:resolveUrn($urn as xs:string) as node()?{<br/&gt;    <br/&gt;    let $tokenizedUrn := tokenize($urn, &#34;:&#34;)<br/&gt;    <br/&gt;    let $allMatches :=<br/&gt;        for $identifiableFromId in collection(&amp;apos;/db/apps/dda-urn&amp;apos;)//*[ft:query(@id, $tokenizedUrn[4])]<br/&gt;            return<br/&gt;            if (local:findVersion($identifiableFromId) = $tokenizedUrn[5]) then<br/&gt;                $identifiableFromId<br/&gt;            else ()<br/&gt;    <br/&gt;    return $allMatches[1]<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $urn as xs:string) as node()?<br><br></li></ul><p> Returns the DDI element specified by an ID and version</p><ul><li>Parameters:</li><ul><li>$urn - the URN address in the format urn:ddi:[agency].[sub_agency]:[id]:[version], for instance urn:ddi:dk.dda:quei-c5539352-4c17-42e7-b6b4-ea775ccc82fb:1.0.0<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="2">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr><tr><td>tokenize</td></tr></table></div></div>&nbsp;</div>&nbsp;<div align="left"><i>Created by xqDoc-Lite version 1.0 on Fri Nov 29 01:24:27 CET 2013</i></div></body></html>