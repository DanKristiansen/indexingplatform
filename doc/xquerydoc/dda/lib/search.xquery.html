<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xml:space="preserve"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>xqDoc -- Module</title><script language="JavaScript"><!--
        function popUp(URL) {
                 day = new Date();
                 id = day.getTime();
                 eval("page = window.open(URL, 'xqdoccode', 'toolbar=0,scrollbars=1,location=0,statusbar=0,menubar=0,resizable=1,width=600,height=400,left = 412,top = 334');")
                 page.focus();
        }
      --></script><script language="JavaScript"><!--
	    function litePopUp(str) {    
  		  OpenWindow=window.open('', 'xqdoccode', 'toolbar=0,scrollbars=1,location=0,statusbar=0,menubar=0,resizable=1,width=600,height=400,left = 412,top = 334');
  		  OpenWindow.document.write('<html xmlspace="preserve">');
  		  OpenWindow.document.write('<head>');
  		  OpenWindow.document.write('<title>xqDoc - Code Sample</title>');
  		  OpenWindow.document.write('</head>');  		    		    		  
  		  OpenWindow.document.write('<body xml:space="preserve">');
  		  OpenWindow.document.write('<pre>');
 		  OpenWindow.document.write(str);
 		  OpenWindow.document.write('</pre>');
  		  OpenWindow.document.write('</body>');
  		  OpenWindow.document.write('</html>');
  		  OpenWindow.document.close();
  		  page.focus();
        }
      --></script><style><!--
body		{
		font: 80% Verdana;
		}
table		{
		font-size: 100%;
		}
h1, h2, h3, h4, h5, h6
		{
		clear: both;
		float: none;
		}
h1		{
		font-size: 100%;
		margin: 0em;
		}
h2		{
		font-size: 180%;
		margin-bottom: -1em;
		margin-top: .3em;
		}
h3		{
		font-size: 150%;
		}	
h4		{
		font-size: 140%;
		background-color: #ccf;
		border-bottom: 1px solid #99f;
		width: 100%;
		}
h5		{
		margin: 1em 0em 0em 0em;
		font-size: 120%;
		}
h6		{
		margin: 0em 0em 0em 3em;
		font-style: italic;
		font: bold italic;
		font-size: 100%;
		}
#variables, #methods, #methoddetail
		{
		padding-left: 3em;
		margin-bottom: 1.4em;
		clear: both;
		float: none;
		}
#methods ul.method, #variables ul.method
		{
		margin: 1em 0em 0em;
		}
#methoddetail ul.method
		{
		margin: 0em;
		}
div.inexternal
		{
		padding-left: 2em;
		margin-bottom: 1em;
		}
div.methoddetail p
		{
		float: none;
		clear: both;
		padding-left: 2em;
		margin-bottom: 1em;
		}
div.methoddetail{
		padding-bottom: 1em;
		}
div.methoddetail li
		{
		list-style-type: none;
		font-weight: bold;
		}
div.methoddetail li li
		{
		list-style-type: circle;
		font-weight: normal;
		}
div.methoddetail li ul
		{
		padding-bottom: 0.5em;
		font-weight: normal;
		}
table.inexternal{
		clear: both;
		float: none;
		width: 80%;
		margin-left: 3em;
		padding: 0em;
		
		}
table.inexternal th
		{
		background-color:#dedede;
		width: 50%;
		}			
td		{
		vertical-align: top;
		}
div.description {
		margin-top: .5em;
		font-weight: normal;
		padding-left: 1em;
		}
ul.method	{
		clear: both;
		float: none;
		width: 90%;
		list-style-type: none;
		border-top: 1px solid #ccc;
		}
ul.method li.left
		{
		float: left;
		clear: none;
		width: 40%;
		font-weight: bold;
		margin-bottom: 2em;
		}
ul.method li.right
		{
		position: relative;
            top: 0em;
		float: left;
            width: 55%;
		margin-bottom: 2em;
		padding-left: 2em;
		}
div.home 	{
		width: 60%;
		float: left;
		margin-right: 1%;
		border: 1px
		}
div.home h4	{
		font-size: 120%;
		background-color: #fff;
		border-bottom: 1px solid #99f;
		width: 100%;
		margin-bottom: -1em;
		}
div.overview p {
               width: 60%;
               }
     
 --></style></head><body><h4>Module URI</h4><h1>http://dda.dk/ddi</h1><h4>Module Description</h4><p> This module contains the search functions and is used by other XQuery scripts to retrieve the data from the database. The main functions for this are <b xmlns:xqdoc="http://www.xqdoc.org/1.0">dda:simpleSearch</b>  and <b xmlns:xqdoc="http://www.xqdoc.org/1.0">dda:advancedSearch</b>. Additionally, it is possible to retrieve a specific DDI element by its ID using the <b xmlns:xqdoc="http://www.xqdoc.org/1.0">dda:lookupXXX</b> functions.<br xmlns:xqdoc="http://www.xqdoc.org/1.0"> The rest of the functions are local and cannot be used externally. </p><ul></ul>&nbsp;<h4>Imported Modules</h4><div id="imports"><div><ul class="method"><li class="left">http://dda.dk/ddi/result</li><li class="right"></li></ul><ul></ul></div><div><ul class="method"><li class="left">http://www.functx.com</li><li class="right"></li></ul><ul></ul></div></div>&nbsp;<h4>Function Summary</h4><div id="methods"><a name="methods"></a><ul class="method"><li class="left"><a href="#advancedSearch">advancedSearch</a><div class="description"> Makes a free-text search in all indexed elements and returns a list of LightXmlObject elements with the results</div></li><li class="right">( $search-parameters as element()) as element()*<br><br></li></ul><ul class="method"><li class="left"><a href="#buildLightXmlObjectList">buildLightXmlObjectList</a><div class="description"> Makes a LightXmlObjectList element containing the info based on the result list</div></li><li class="right">( $results as element()* ,<br>&nbsp; $hits-perpage as xs:integer ,<br>&nbsp; $hit-start as xs:integer ,<br>&nbsp; $search-parameters as element() ,<br>&nbsp; $advanced as xs:boolean) as element()<br><br></li></ul><ul class="method"><li class="left"><a href="#conditionalIntersection">conditionalIntersection</a><div class="description"> Makes intersection only on lists which were requested by the search parameters</div></li><li class="right">( $set1 as element()* ,<br>&nbsp; $required1 as xs:boolean ,<br>&nbsp; $set2 as element()* ,<br>&nbsp; $required2 as xs:boolean ,<br>&nbsp; $set3 as element()* ,<br>&nbsp; $required3 as xs:boolean ,<br>&nbsp; $set4 as element()* ,<br>&nbsp; $required4 as xs:boolean ,<br>&nbsp; $set5 as element()* ,<br>&nbsp; $required5 as xs:boolean ,<br>&nbsp; $set6 as element()* ,<br>&nbsp; $required6 as xs:boolean ,<br>&nbsp; $set7 as element()* ,<br>&nbsp; $required7 as xs:boolean) as node()*<br><br></li></ul><ul class="method"><li class="left"><a href="#getDdiStudy">getDdiStudy</a><div class="description"> Makes a free-text search in StudyUnit elements and returns the element(s) containing the match It also sorts the list by score in descending order</div></li><li class="right">( $studyId as xs:string) as element()*<br><br></li></ul><ul class="method"><li class="left"><a href="#idIntersect">idIntersect</a><div class="description"> Custom intersection function which operates on element id's</div></li><li class="right">( $set1 as element()* ,<br>&nbsp; $set2 as element()*) as node()*<br><br></li></ul><ul class="method"><li class="left"><a href="#idUnion">idUnion</a><div class="description"> Custom union function which operates on element id's</div></li><li class="right">( $set1 as element()* ,<br>&nbsp; $set2 as element()*) as node()*<br><br></li></ul><ul class="method"><li class="left"><a href="#listDdiStudies">listDdiStudies</a><div class="description"></div></li><li class="right">( $lang as xs:string) as element()*<br><br></li></ul><ul class="method"><li class="left"><a href="#lookupCategory">lookupCategory</a><div class="description"> Searches for a Category and returns a LightXmlObjectList element with the result</div></li><li class="right">( $categoryId as xs:string) as element()<br><br></li></ul><ul class="method"><li class="left"><a href="#lookupConcept">lookupConcept</a><div class="description"> Searches for a Concept and returns a LightXmlObjectList element with the result</div></li><li class="right">( $conceptId as xs:string) as element()<br><br></li></ul><ul class="method"><li class="left"><a href="#lookupMultipleQuestionItem">lookupMultipleQuestionItem</a><div class="description"> Searches for a MultipleQuestionItem and returns a LightXmlObjectList element with the result</div></li><li class="right">( $multipleQuestionItemId as xs:string) as element()<br><br></li></ul><ul class="method"><li class="left"><a href="#lookupQuestionItem">lookupQuestionItem</a><div class="description"> Searches for a QuestionItem and returns a LightXmlObjectList element with the result</div></li><li class="right">( $questionItemId as xs:string) as element()<br><br></li></ul><ul class="method"><li class="left"><a href="#lookupUniverse">lookupUniverse</a><div class="description"> Searches for a Universe and returns a LightXmlObjectList element with the result</div></li><li class="right">( $universeId as xs:string) as element()<br><br></li></ul><ul class="method"><li class="left"><a href="#lookupVariable">lookupVariable</a><div class="description"> Searches for a Variable and returns a LightXmlObjectList element with the result</div></li><li class="right">( $variableId as xs:string) as element()<br><br></li></ul><ul class="method"><li class="left"><a href="#queryCategory">queryCategory</a><div class="description"> Makes a free-text search in Category elements and returns the element(s) containing the match It also sorts the list by score in descending order</div></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><ul class="method"><li class="left"><a href="#queryConcept">queryConcept</a><div class="description"> Makes a free-text search in Concept elements and returns the element(s) containing the match It also sorts the list by score in descending order</div></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><ul class="method"><li class="left"><a href="#queryMultipleQuestionItem">queryMultipleQuestionItem</a><div class="description"> Makes a free-text search in MultipleQuestionItem elements and returns the element(s) containing the match It also sorts the list by score in descending order</div></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><ul class="method"><li class="left"><a href="#queryQuestionItem">queryQuestionItem</a><div class="description"> Makes a free-text search in QuestionItem elements and returns the element(s) containing the match It also sorts the list by score in descending order</div></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><ul class="method"><li class="left"><a href="#queryStudyUnit">queryStudyUnit</a><div class="description"> Makes a free-text search in StudyUnit elements and returns the element(s) containing the match It also sorts the list by score in descending order</div></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><ul class="method"><li class="left"><a href="#queryUniverse">queryUniverse</a><div class="description"> Makes a free-text search in Universe elements and returns the element(s) containing the match It also sorts the list by score in descending order</div></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><ul class="method"><li class="left"><a href="#queryVariable">queryVariable</a><div class="description"> Makes a free-text search in Variable elements and returns the element(s) containing the match It also sorts the list by score in descending order</div></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><ul class="method"><li class="left"><a href="#simpleSearch">simpleSearch</a><div class="description"> Makes a free-text search in all indexed elements and returns a list of LightXmlObject elements with the results</div></li><li class="right">( $search-parameters as element()) as element()<br><br></li></ul><ul class="method"><li class="left"><a href="#studyUnitsFromParameters">studyUnitsFromParameters</a><div class="description"> Finds studies based on advanced search parameters</div></li><li class="right">( $search-parameters as element()) as element()*<br><br></li></ul></div>&nbsp;<h4>Function Detail</h4><div id="methoddetail"><div id="advancedSearch" class="methoddetail"><h5><a name="advancedSearch"></a>advancedSearch</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function ddi:advancedSearch($search-parameters as element()) as element()*{<br/&gt;    <br/&gt;    let $search-scope := $search-parameters/s:Scope<br/&gt;    <br/&gt;    let $studyUnits := local:studyUnitsFromParameters($search-parameters)<br/&gt;    <br/&gt;    <br/&gt;    let $variableSearch := if (data($search-parameters/asp:Variable)) then true() else false()<br/&gt;    let $questionItemSearch := if (data($search-parameters/asp:QuestionItem)) then true() else false()<br/&gt;    let $multipleQuestionItemSearch := if (data($search-parameters/asp:MultipleQuestionItem)) then true() else false()<br/&gt;    let $universeSearch := if (data($search-parameters/asp:Universe)) then true() else false()<br/&gt;    let $conceptSearch := if (data($search-parameters/asp:Concept)) then true() else false()<br/&gt;    let $categorySearch := if (data($search-parameters/asp:Category)) then true() else false()<br/&gt;<br/&gt;    let $searchSpecificElements :=<br/&gt;        $variableSearch             or<br/&gt;        $questionItemSearch         or<br/&gt;        $multipleQuestionItemSearch or<br/&gt;        $universeSearch             or<br/&gt;        $conceptSearch              or<br/&gt;        $categorySearch<br/&gt;        <br/&gt;    let $studyParametersEntered := $search-parameters/asp:studyId          or<br/&gt;                                   $search-parameters/asp:title            or<br/&gt;                                   $search-parameters/asp:topicalCoverage  or<br/&gt;                                   $search-parameters/asp:spatialCoverage  or<br/&gt;                                   $search-parameters/asp:abstract-purpose or<br/&gt;                                   $search-parameters/asp:creator          or<br/&gt;                                   $search-parameters/asp:kindOfData       or<br/&gt;                                   $search-parameters/asp:coverageFrom     or<br/&gt;                                   $search-parameters/asp:coverageTo<br/&gt;                                   <br/&gt;    <br/&gt;    <br/&gt;    <br/&gt;    let $variableResults := if ($variableSearch) then local:queryVariable($search-parameters/asp:Variable) else ()<br/&gt;    let $usableVariables :=<br/&gt;            <br/&gt;            if ($studyParametersEntered) then<br/&gt;                <br/&gt;                for $variable in $variableResults<br/&gt;                    let $denormalizedVariable := collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Variable[ft:query(@id, $variable/@id)]<br/&gt;                    return if ($studyUnits[@id = $denormalizedVariable/@studyId]) then $variable else ()<br/&gt;            <br/&gt;            else $variableResults<br/&gt;            <br/&gt;    let $questionItemResults := if ($questionItemSearch) then local:queryQuestionItem($search-parameters/asp:QuestionItem) else ()<br/&gt;    let $usableQuestionItems :=<br/&gt;            <br/&gt;            if ($studyParametersEntered) then<br/&gt;                <br/&gt;                for $questionItem in $questionItemResults<br/&gt;                    let $denormalizedQuestionItem := collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:QuestionItem[ft:query(@id, $questionItem/@id)]<br/&gt;                    return if ($studyUnits[@id = $denormalizedQuestionItem/@studyId]) then $questionItem else ()<br/&gt;            <br/&gt;            else $questionItemResults<br/&gt;            <br/&gt;    let $multipleQuestionItemResults := if ($multipleQuestionItemSearch) then local:queryMultipleQuestionItem($search-parameters/asp:MultipleQuestionItem) else ()<br/&gt;    let $usableMultipleQuestionItems :=<br/&gt;            <br/&gt;            if ($studyParametersEntered) then<br/&gt;                <br/&gt;                for $multipleQuestionItem in $multipleQuestionItemResults<br/&gt;                    let $denormalizedMultipleQuestionItem := collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:MultipleQuestionItem[ft:query(@id, $multipleQuestionItem/@id)]<br/&gt;                    return if ($studyUnits[@id = $denormalizedMultipleQuestionItem/@studyId]) then $multipleQuestionItem else ()<br/&gt;            <br/&gt;            else $multipleQuestionItemResults<br/&gt;    <br/&gt;    let $universeResults := if ($universeSearch) then local:queryUniverse($search-parameters/asp:Universe) else ()<br/&gt;    let $usableUniverses :=<br/&gt;            <br/&gt;            if ($studyParametersEntered) then<br/&gt;                <br/&gt;                for $universe in $universeResults<br/&gt;                    let $denormalizedUniverse := collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Universe[ft:query(@id, $universe/@id)]<br/&gt;                    return if ($studyUnits[@id = $denormalizedUniverse/@studyId]) then $universe else ()<br/&gt;            <br/&gt;            else $universeResults<br/&gt;            <br/&gt;    let $conceptResults := if ($conceptSearch) then local:queryConcept($search-parameters/asp:Concept) else ()<br/&gt;    let $usableConcepts :=<br/&gt;            <br/&gt;            if ($studyParametersEntered) then<br/&gt;                <br/&gt;                for $concept in $conceptResults<br/&gt;                    let $denormalizedConcept := collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Concept[ft:query(@id, $concept/@id)]<br/&gt;                    return if ($studyUnits[@id = $denormalizedConcept/@studyId]) then $concept else ()<br/&gt;            <br/&gt;            else $conceptResults<br/&gt;            <br/&gt;    let $categoryResults := if ($categorySearch) then local:queryCategory($search-parameters/asp:Category) else ()<br/&gt;    let $usableCategories :=<br/&gt;            <br/&gt;            if ($studyParametersEntered) then<br/&gt;                <br/&gt;                for $category in $categoryResults<br/&gt;                    let $denormalizedCategory := collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Category[ft:query(@id, $category/@id)]<br/&gt;                    return if ($studyUnits[@id = $denormalizedCategory/@studyId]) then $category else ()<br/&gt;            <br/&gt;            else $categoryResults<br/&gt;    <br/&gt;    <br/&gt;    <br/&gt;    let $foundStudies :=<br/&gt;        if ($search-scope/s:StudyUnit) then<br/&gt;            let $studiesFromStudies :=<br/&gt;                for $element in $studyUnits<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;StudyUnit&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $studyId in $element/@id return &amp;lt;d:StudyUnit id=&#34;{$studyId}&#34;&amp;gt;{$hit}&amp;lt;/d:StudyUnit&amp;gt;<br/&gt;            let $studiesFromVariables :=<br/&gt;                for $element in $usableVariables<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;StudyUnit&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $studyId in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Variable[ft:query(@id, $element/@id)]/@studyId return &amp;lt;d:StudyUnit id=&#34;{$studyId}&#34;&amp;gt;{$hit}&amp;lt;/d:StudyUnit&amp;gt;<br/&gt;            let $studiesFromQuestionItems :=<br/&gt;                for $element in $usableQuestionItems<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;StudyUnit&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $studyId in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:QuestionItem[ft:query(@id, $element/@id)]/@studyId return &amp;lt;d:StudyUnit id=&#34;{$studyId}&#34;&amp;gt;{$hit}&amp;lt;/d:StudyUnit&amp;gt;<br/&gt;            let $studiesFromMultipleQuestionItems :=<br/&gt;                for $element in $usableMultipleQuestionItems<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;StudyUnit&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $studyId in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:MultipleQuestionItem[ft:query(@id, $element/@id)]/@studyId return &amp;lt;d:StudyUnit id=&#34;{$studyId}&#34;&amp;gt;{$hit}&amp;lt;/d:StudyUnit&amp;gt;<br/&gt;            let $studiesFromUniverses :=<br/&gt;                for $element in $usableUniverses<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;StudyUnit&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $studyId in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Universe[ft:query(@id, $element/@id)]/@studyId return &amp;lt;d:StudyUnit id=&#34;{$studyId}&#34;&amp;gt;{$hit}&amp;lt;/d:StudyUnit&amp;gt;<br/&gt;            let $studiesFromConcepts :=<br/&gt;                for $element in $usableConcepts<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;StudyUnit&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $studyId in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Concept[ft:query(@id, $element/@id)]/@studyId return &amp;lt;d:StudyUnit id=&#34;{$studyId}&#34;&amp;gt;{$hit}&amp;lt;/d:StudyUnit&amp;gt;<br/&gt;            let $studiesFromCategories :=<br/&gt;                for $element in $usableCategories<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;StudyUnit&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $studyId in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Category[ft:query(@id, $element/@id)]/@studyId return &amp;lt;d:StudyUnit id=&#34;{$studyId}&#34;&amp;gt;{$hit}&amp;lt;/d:StudyUnit&amp;gt;<br/&gt;            <br/&gt;            return local:conditionalIntersection($studiesFromStudies, $studyParametersEntered,<br/&gt;                                                 $studiesFromVariables, $variableSearch,<br/&gt;                                                 $studiesFromQuestionItems, $questionItemSearch,<br/&gt;                                                 $studiesFromMultipleQuestionItems, $multipleQuestionItemSearch,<br/&gt;                                                 $studiesFromUniverses, $universeSearch,<br/&gt;                                                 $studiesFromConcepts, $conceptSearch,<br/&gt;                                                 $studiesFromCategories, $categorySearch)<br/&gt;        else ()<br/&gt;        <br/&gt;    let $foundVariables :=<br/&gt;        if ($search-scope/s:Variable) then<br/&gt;            let $variablesFromVariables :=<br/&gt;                for $element in $usableVariables<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Variable&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $variable in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Variable[ft:query(@id, $element/@id)] return &amp;lt;d:Variable id=&#34;{$variable/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Variable&amp;gt;<br/&gt;            let $variablesFromStudies :=<br/&gt;                for $element in $studyUnits<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;StudyUnit&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $variable in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Variable[ft:query(@studyId, $element/@id)] return &amp;lt;d:Variable id=&#34;{$variable/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Variable&amp;gt;<br/&gt;            let $variablesFromQuestionItems :=<br/&gt;                for $element in $usableQuestionItems<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;QuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $variable in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Variable[ft:query(d:QuestionItemReference/@id, $element/@id)] return &amp;lt;d:Variable id=&#34;{$variable/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Variable&amp;gt;<br/&gt;            let $variablesFromMultipleQuestionItems :=<br/&gt;                for $element in $usableMultipleQuestionItems<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;MultipleQuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $variable in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Variable[ft:query(d:MultipleQuestionItemReference/@id, $element/@id)] return &amp;lt;d:Variable id=&#34;{$variable/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Variable&amp;gt;<br/&gt;            let $variablesFromUniverses :=<br/&gt;                for $element in $usableUniverses<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Universe&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $variable in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Variable[ft:query(d:UniverseReference/@id, $element/@id)] return &amp;lt;d:Variable id=&#34;{$variable/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Variable&amp;gt;<br/&gt;            let $variablesFromConcepts :=<br/&gt;                for $element in $usableConcepts<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Concept&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $variable in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Variable[ft:query(d:ConceptReference/@id, $element/@id)] return &amp;lt;d:Variable id=&#34;{$variable/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Variable&amp;gt;<br/&gt;            let $variablesFromCategories :=<br/&gt;                for $element in $usableCategories<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Category&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $variable in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Variable[ft:query(d:CategoryReference/@id, $element/@id)] return &amp;lt;d:Variable id=&#34;{$variable/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Variable&amp;gt;        <br/&gt;            return local:conditionalIntersection($variablesFromVariables, $variableSearch,<br/&gt;                                                 $variablesFromStudies, $studyParametersEntered,<br/&gt;                                                 $variablesFromQuestionItems, $questionItemSearch,<br/&gt;                                                 $variablesFromMultipleQuestionItems, $multipleQuestionItemSearch,<br/&gt;                                                 $variablesFromUniverses, $universeSearch,<br/&gt;                                                 $variablesFromConcepts, $conceptSearch,<br/&gt;                                                 $variablesFromCategories, $categorySearch)<br/&gt;        else ()<br/&gt;        <br/&gt;    let $foundQuestionItems :=<br/&gt;        if ($search-scope/s:QuestionItem) then<br/&gt;            let $questionItemsFromQuestionItems :=<br/&gt;                for $element in $usableQuestionItems<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;QuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $questionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:QuestionItem[ft:query(@id, $element/@id)] return &amp;lt;d:QuestionItem id=&#34;{$questionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:QuestionItem&amp;gt;<br/&gt;            let $questionItemsFromStudies :=<br/&gt;                for $element in $studyUnits<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;QuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $questionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:QuestionItem[ft:query(@studyId, $element/@id)] return &amp;lt;d:QuestionItem id=&#34;{$questionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:QuestionItem&amp;gt;<br/&gt;            let $questionItemsFromVariables :=<br/&gt;                for $element in $usableVariables<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;QuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $questionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:QuestionItem[ft:query(d:VariableReference/@id, $element/@id)] return &amp;lt;d:QuestionItem id=&#34;{$questionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:QuestionItem&amp;gt;<br/&gt;            let $questionItemsFromUniverses :=<br/&gt;                for $element in $usableUniverses<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;QuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $questionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:QuestionItem[ft:query(d:UniverseReference/@id, $element/@id)] return &amp;lt;d:QuestionItem id=&#34;{$questionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:QuestionItem&amp;gt;<br/&gt;            let $questionItemsFromConcepts :=<br/&gt;                for $element in $usableConcepts<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;QuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $questionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:QuestionItem[ft:query(d:ConceptReference/@id, $element/@id)] return &amp;lt;d:QuestionItem id=&#34;{$questionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:QuestionItem&amp;gt;<br/&gt;            let $questionItemsFromCategories :=<br/&gt;                for $element in $usableCategories<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;QuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $questionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:QuestionItem[ft:query(d:CategoryReference/@id, $element/@id)] return &amp;lt;d:QuestionItem id=&#34;{$questionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:QuestionItem&amp;gt;<br/&gt;            return local:conditionalIntersection($questionItemsFromQuestionItems, $questionItemSearch,<br/&gt;                                                 $questionItemsFromStudies, $studyParametersEntered,<br/&gt;                                                 $questionItemsFromVariables, $variableSearch,<br/&gt;                                                 $questionItemsFromUniverses, $universeSearch,<br/&gt;                                                 $questionItemsFromConcepts, $conceptSearch,<br/&gt;                                                 $questionItemsFromCategories, $categorySearch,<br/&gt;                                                 (), false())<br/&gt;        else ()<br/&gt;        <br/&gt;    let $foundMultipleQuestionItems :=<br/&gt;        if ($search-scope/s:MultipleQuestionItem) then<br/&gt;            let $multipleQuestionItemsFromMultipleQuestionItems :=<br/&gt;            for $element in $usableMultipleQuestionItems<br/&gt;                let $hit := &amp;lt;d:Hit elementType=&#34;MultipleQuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                for $multipleQuestionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:MultipleQuestionItem[ft:query(@id, $element/@id)] return &amp;lt;d:MultipleQuestionItem id=&#34;{$multipleQuestionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:MultipleQuestionItem&amp;gt;<br/&gt;            let $multipleQuestionItemsFromStudies :=<br/&gt;            for $element in $studyUnits<br/&gt;                let $hit := &amp;lt;d:Hit elementType=&#34;MultipleQuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                for $multipleQuestionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:MultipleQuestionItem[ft:query(@studyId, $element/@id)] return &amp;lt;d:MultipleQuestionItem id=&#34;{$multipleQuestionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:MultipleQuestionItem&amp;gt;<br/&gt;            let $multipleQuestionItemsFromVariables :=<br/&gt;            for $element in $usableVariables<br/&gt;                let $hit := &amp;lt;d:Hit elementType=&#34;MultipleQuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                for $multipleQuestionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:MultipleQuestionItem[ft:query(d:VariableReference/@id, $element/@id)] return &amp;lt;d:MultipleQuestionItem id=&#34;{$multipleQuestionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:MultipleQuestionItem&amp;gt;<br/&gt;            let $multipleQuestionItemsFromUniverses :=<br/&gt;            for $element in $usableUniverses<br/&gt;                let $hit := &amp;lt;d:Hit elementType=&#34;MultipleQuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                for $multipleQuestionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:MultipleQuestionItem[ft:query(d:UniverseReference/@id, $element/@id)] return &amp;lt;d:MultipleQuestionItem id=&#34;{$multipleQuestionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:MultipleQuestionItem&amp;gt;<br/&gt;            let $multipleQuestionItemsFromConcepts :=<br/&gt;            for $element in $usableConcepts<br/&gt;                let $hit := &amp;lt;d:Hit elementType=&#34;MultipleQuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                for $multipleQuestionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:MultipleQuestionItem[ft:query(d:ConceptReference/@id, $element/@id)] return &amp;lt;d:MultipleQuestionItem id=&#34;{$multipleQuestionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:MultipleQuestionItem&amp;gt;<br/&gt;            let $multipleQuestionItemsFromCategories :=<br/&gt;            for $element in $usableCategories<br/&gt;                let $hit := &amp;lt;d:Hit elementType=&#34;MultipleQuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                for $multipleQuestionItem in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:MultipleQuestionItem[ft:query(d:CategoryReference/@id, $element/@id)] return &amp;lt;d:MultipleQuestionItem id=&#34;{$multipleQuestionItem/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:MultipleQuestionItem&amp;gt;<br/&gt;            return local:conditionalIntersection($multipleQuestionItemsFromMultipleQuestionItems, $multipleQuestionItemSearch,<br/&gt;                                                 $multipleQuestionItemsFromStudies, $studyParametersEntered,<br/&gt;                                                 $multipleQuestionItemsFromVariables, $variableSearch,<br/&gt;                                                 $multipleQuestionItemsFromUniverses, $universeSearch,<br/&gt;                                                 $multipleQuestionItemsFromConcepts, $conceptSearch,<br/&gt;                                                 $multipleQuestionItemsFromCategories, $categorySearch,<br/&gt;                                                 (), false())<br/&gt;        else ()<br/&gt;        <br/&gt;    let $foundUniverses :=<br/&gt;        if ($search-scope/s:Universe) then<br/&gt;            let $universesFromUniverses :=<br/&gt;                for $element in $usableUniverses<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Universe&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $universe in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Universe[ft:query(@id, $element/@id)] return &amp;lt;d:Universe id=&#34;{$universe/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Universe&amp;gt;<br/&gt;            let $universesFromStudies :=<br/&gt;                for $element in $studyUnits<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Universe&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $universe in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Universe[ft:query(@studyId, $element/@id)] return &amp;lt;d:Universe id=&#34;{$universe/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Universe&amp;gt;<br/&gt;            let $universesFromQuestionItems :=<br/&gt;                for $element in $usableQuestionItems<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Universe&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $universe in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Universe[ft:query(d:QuestionItemReference/@id, $element/@id)] return &amp;lt;d:Universe id=&#34;{$universe/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Universe&amp;gt;<br/&gt;            let $universesFromMultipleQuestionItems :=<br/&gt;                for $element in $usableMultipleQuestionItems<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Universe&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $universe in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Universe[ft:query(d:MultipleQuestionItemReference/@id, $element/@id)] return &amp;lt;d:Universe id=&#34;{$universe/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Universe&amp;gt;<br/&gt;            let $universesFromVariables :=<br/&gt;                for $element in $usableVariables<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Universe&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $universe in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Universe[ft:query(d:VariableReference/@id, $element/@id)] return &amp;lt;d:Universe id=&#34;{$universe/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Universe&amp;gt;<br/&gt;            let $universesFromConcepts :=<br/&gt;                for $element in $usableConcepts<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Universe&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $universe in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Universe[ft:query(d:ConceptReference/@id, $element/@id)] return &amp;lt;d:Universe id=&#34;{$universe/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Universe&amp;gt;<br/&gt;            let $universesFromCategories :=<br/&gt;                for $element in $usableCategories<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Universe&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $universe in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Universe[ft:query(d:CategoryReference/@id, $element/@id)] return &amp;lt;d:Universe id=&#34;{$universe/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Universe&amp;gt;<br/&gt;            return local:conditionalIntersection($universesFromUniverses, $universeSearch,<br/&gt;                                                 $universesFromStudies, $studyParametersEntered,<br/&gt;                                                 $universesFromQuestionItems, $questionItemSearch,<br/&gt;                                                 $universesFromMultipleQuestionItems, $multipleQuestionItemSearch,<br/&gt;                                                 $universesFromVariables, $variableSearch,<br/&gt;                                                 $universesFromConcepts, $conceptSearch,<br/&gt;                                                 $universesFromCategories, $categorySearch)<br/&gt;        else ()<br/&gt;        <br/&gt;    let $foundConcepts :=<br/&gt;        if ($search-scope/s:Concept) then<br/&gt;            let $conceptsFromConcepts :=<br/&gt;                for $element in $usableConcepts<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Concept&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $concept in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Concept[ft:query(@id, $element/@id)] return &amp;lt;d:Concept id=&#34;{$concept/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Concept&amp;gt;<br/&gt;            let $conceptsFromStudies :=<br/&gt;                for $element in $studyUnits<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Concept&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $concept in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Concept[ft:query(@studyId, $element/@id)] return &amp;lt;d:Concept id=&#34;{$concept/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Concept&amp;gt;<br/&gt;            let $conceptsFromQuestionItems :=   <br/&gt;                for $element in $usableQuestionItems<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Concept&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $concept in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Concept[ft:query(d:QuestionItemReference/@id, $element/@id)] return &amp;lt;d:Concept id=&#34;{$concept/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Concept&amp;gt;<br/&gt;            let $conceptsFromMultipleQuestionItems :=<br/&gt;                for $element in $usableMultipleQuestionItems<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Concept&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $concept in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Concept[ft:query(d:MultipleQuestionItemReference/@id, $element/@id)] return &amp;lt;d:Concept id=&#34;{$concept/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Concept&amp;gt;<br/&gt;            let $conceptsFromUniverses :=<br/&gt;                for $element in $usableUniverses<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Concept&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $concept in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Concept[ft:query(d:UniverseReference/@id, $element/@id)] return &amp;lt;d:Concept id=&#34;{$concept/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Concept&amp;gt;<br/&gt;            let $conceptsFromVariables :=<br/&gt;                for $element in $usableVariables<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Concept&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $concept in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Concept[ft:query(d:VariableReference/@id, $element/@id)] return &amp;lt;d:Concept id=&#34;{$concept/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Concept&amp;gt;<br/&gt;            let $conceptsFromCategories :=<br/&gt;                for $element in $usableCategories<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Concept&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $concept in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Concept[ft:query(d:CategoryReference/@id, $element/@id)] return &amp;lt;d:Concept id=&#34;{$concept/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Concept&amp;gt;<br/&gt;            return local:conditionalIntersection($conceptsFromConcepts, $conceptSearch,<br/&gt;                                                 $conceptsFromStudies, $studyParametersEntered,<br/&gt;                                                 $conceptsFromQuestionItems, $questionItemSearch,<br/&gt;                                                 $conceptsFromMultipleQuestionItems, $multipleQuestionItemSearch,<br/&gt;                                                 $conceptsFromUniverses, $universeSearch,<br/&gt;                                                 $conceptsFromVariables, $variableSearch,<br/&gt;                                                 $conceptsFromCategories, $categorySearch)<br/&gt;        else ()<br/&gt;         <br/&gt;    let $foundCategories :=<br/&gt;        if ($search-scope/s:Category) then<br/&gt;            let $categoriesFromCategories :=<br/&gt;                for $element in $usableCategories<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Category&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $category in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Category[ft:query(@id, $element/@id)] return &amp;lt;d:Category id=&#34;{$category/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Category&amp;gt;<br/&gt;            let $categoriesFromStudies :=<br/&gt;                for $element in $studyUnits<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;StudyUnit&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $category in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Category[ft:query(@studyId, $element/@id)] return &amp;lt;d:Category id=&#34;{$category/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Category&amp;gt;<br/&gt;            let $categoriesFromQuestionItems :=<br/&gt;                for $element in $usableQuestionItems<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;QuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $category in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Category[ft:query(d:QuestionItemReference/@id, $element/@id)] return &amp;lt;d:Category id=&#34;{$category/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Category&amp;gt;<br/&gt;            let $categoriesFromMultipleQuestionItems :=<br/&gt;                for $element in $usableMultipleQuestionItems<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;MultipleQuestionItem&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $category in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Category[ft:query(d:MultipleQuestionItemReference/@id, $element/@id)] return &amp;lt;d:Category id=&#34;{$category/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Category&amp;gt;<br/&gt;            let $categoriesFromUniverses :=<br/&gt;                for $element in $usableUniverses<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Universe&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $category in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Category[ft:query(d:UniverseReference/@id, $element/@id)] return &amp;lt;d:Category id=&#34;{$category/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Category&amp;gt;<br/&gt;            let $categoriesFromConcepts :=<br/&gt;                for $element in $usableConcepts<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Concept&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $category in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Category[ft:query(d:ConceptReference/@id, $element/@id)] return &amp;lt;d:Category id=&#34;{$category/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Category&amp;gt;<br/&gt;            let $categoriesFromVariables :=<br/&gt;                for $element in $usableVariables<br/&gt;                    let $hit := &amp;lt;d:Hit elementType=&#34;Variable&#34;&amp;gt;{util:expand($element)//exist:match/parent::*}&amp;lt;/d:Hit&amp;gt;<br/&gt;                    for $category in collection(&amp;apos;/db/apps/dda-denormalization&amp;apos;)//d:Category[ft:query(d:VariableReference/@id, $element/@id)] return &amp;lt;d:Category id=&#34;{$category/@id}&#34;&amp;gt;{$hit}&amp;lt;/d:Category&amp;gt;<br/&gt;            return local:conditionalIntersection($categoriesFromCategories, $categorySearch,<br/&gt;                                                 $categoriesFromStudies, $studyParametersEntered,<br/&gt;                                                 $categoriesFromQuestionItems, $questionItemSearch,<br/&gt;                                                 $categoriesFromMultipleQuestionItems, $multipleQuestionItemSearch,<br/&gt;                                                 $categoriesFromUniverses, $universeSearch,<br/&gt;                                                 $categoriesFromConcepts, $conceptSearch,<br/&gt;                                                 $categoriesFromVariables, $variableSearch)<br/&gt;        else ()    <br/&gt;    <br/&gt;    let $results := ($foundStudies, $foundVariables, $foundQuestionItems, $foundMultipleQuestionItems, $foundUniverses, $foundConcepts, $foundCategories)<br/&gt;<br/&gt;    <br/&gt;    return ddi:buildLightXmlObjectList($results, data($search-parameters/smd:SearchMetaData/@hits-perpage), data($search-parameters/smd:SearchMetaData/@hit-start), $search-parameters, true())<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-parameters as element()) as element()*<br><br></li></ul><p> Makes a free-text search in all indexed elements and returns a list of LightXmlObject elements with the results</p><ul><li>Parameters:</li><ul><li>$search-parameters - the search parameters wrapped in a AdvancedSearchParameters element with the following format:  <br xmlns:xqdoc="http://www.xqdoc.org/1.0">   <pre xmlns:xqdoc="http://www.xqdoc.org/1.0">&lt;asp:AdvancedSearchParameters xmlns:smd="http://dda.dk/ddi/search-metadata"<br> xmlns:asp="http://dda.dk/ddi/advanced-search-parameters"<br> xmlns:s="http://dda.dk/ddi/scope"<br> xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;<br>    &lt;asp:studyId&gt;studyId0&lt;/asp:studyId&gt;                                              &lt;!-- Id of the StudyUnit we wish to limit the results to (xs:string). Optional. --&gt;<br>    &lt;asp:title&gt;title0&lt;/asp:title&gt;                                                    &lt;!-- Title of the StudyUnit(s) we wish to limit the results to (xs:string). Optional. --&gt;<br>    &lt;asp:topicalCoverage&gt;topicalCoverage0&lt;/asp:topicalCoverage&gt;                      &lt;!-- TopicalCoverage of the StudyUnit(s) we wish to limit the results to (xs:string). Optional. --&gt;<br>    &lt;asp:spatialCoverage&gt;spatialCoverage0&lt;/asp:spatialCoverage&gt;                      &lt;!-- SpatialCoverage of the StudyUnit(s) we wish to limit the results to (xs:string). Optional. --&gt;<br>    &lt;asp:abstract-purpose&gt;abstract-purpose0&lt;/asp:abstract-purpose&gt;                   &lt;!-- Purpose of the StudyUnit(s) we wish to limit the results to (xs:string). Optional. --&gt;<br>    &lt;asp:creator&gt;creator0&lt;/asp:creator&gt;                                              &lt;!-- Creator of the StudyUnit(s) we wish to limit the results to (xs:string). Optional. --&gt;<br>    &lt;asp:kindOfData&gt;kindOfData0&lt;/asp:kindOfData&gt;                                     &lt;!-- KindOfData of the StudyUnit(s) we wish to limit the results to (xs:string). Optional. --&gt;<br>    &lt;asp:coverageFrom&gt;2006-05-04&lt;/asp:coverageFrom&gt;                                  &lt;!-- Starting coverage date of the StudyUnit we wish to limit the results to (xs:date). Optional. --&gt;<br>    &lt;asp:coverageTo&gt;2006-05-04&lt;/asp:coverageTo&gt;                                      &lt;!-- Ending coverage date of the StudyUnit we wish to limit the results to (xs:date). Optional. --&gt;<br>    &lt;asp:Variable&gt;variable text&lt;/asp:Variable&gt;                                       &lt;!-- Search-text for the Variable(s) we wish to find (xs:string). If left out Variable will not be searched and returned. Optional. --&gt;<br>    &lt;asp:QuestionItem&gt;questionItem text&lt;/asp:QuestionItem&gt;                           &lt;!-- Search-text for the QuestionItem(s) we wish to find (xs:string). If left out QuestionItem will not be searched and returned. Optional. --&gt;<br>    &lt;asp:MultipleQuestionItem&gt;multipleQuestionItem text&lt;/asp:MultipleQuestionItem&gt;   &lt;!-- Search-text for the MultipleQuestionItem(s) we wish to find (xs:string). If left out MultipleQuestionItem will not be searched and returned. Optional. --&gt;<br>    &lt;asp:Universe&gt;universe text&lt;/asp:Universe&gt;                                       &lt;!-- Search-text for the Universe(s) we wish to find (xs:string). If left out Universe will not be searched and returned. Optional. --&gt;<br>    &lt;asp:Concept&gt;concept text&lt;/asp:Concept&gt;                                          &lt;!-- Search-text for the Coverage(s) we wish to find (xs:string). If left out Coverage will not be searched and returned. Optional. --&gt;<br>    &lt;asp:Category&gt;category text&lt;/asp:Category&gt;                                       &lt;!-- Search-text for the Category(s) we wish to find (xs:string). If left out Category will not be searched and returned. Optional. --&gt;<br>    &lt;smd:SearchMetaData hits-perpage="2" hit-start="1"/&gt;                                   &lt;!-- The number of hits we wish to show per page (xs:positiveInteger) and the number of the first result we wish to get (xs:nonNegativeInteger). Both required. --&gt;<br>    &lt;s:Scope&gt;                                                                              &lt;!-- The scope of our results. Each child-element is optional and if it is present the search will return results of that type. The child-elements have no type or content; only the existence is checked. --&gt;<br>        &lt;s:StudyUnit/&gt;<br>        &lt;s:Variable/&gt;<br>        &lt;s:QuestionItem/&gt;<br>        &lt;s:MultipleQuestionItem/&gt;<br>        &lt;s:Universe/&gt;<br>        &lt;s:Concept/&gt;<br>        &lt;s:Category/&gt;<br>    &lt;/s:Scope&gt;<br>&lt;/asp:AdvancedSearchParameters&gt;<br></pre>     <br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="4">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr><tr><td>data</td></tr><tr><td>false</td></tr><tr><td>true</td></tr></table></div><div class="methoddetail"><h6>Internal Functions used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://dda.dk/ddi</td><td><a href="#buildLightXmlObjectList">buildLightXmlObjectList</a></td></tr></table></div></div>&nbsp;<div id="buildLightXmlObjectList" class="methoddetail"><h5><a name="buildLightXmlObjectList"></a>buildLightXmlObjectList</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function ddi:buildLightXmlObjectList($results as element()*, $hits-perpage as xs:integer, $hit-start as xs:integer, $search-parameters as element(), $advanced as xs:boolean) as element(){<br/&gt;    let $result-count := count($results)<br/&gt;    let $hit-end := if ($result-count lt $hits-perpage) then $result-count<br/&gt;                    else $hit-start + $hits-perpage - 1<br/&gt;    let $hit-end-corrected := if ($result-count lt $hit-end) then $result-count<br/&gt;                    else $hit-end<br/&gt;    let $number-of-pages :=  xs:integer(ceiling($result-count div $hits-perpage))<br/&gt;    let $current-page := xs:integer(($hit-start + $hits-perpage) div $hits-perpage)<br/&gt;<br/&gt;    return &amp;lt;dl:LightXmlObjectList xmlns:dl=&#34;ddieditor-lightobject&#34;<br/&gt;        xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;<br/&gt;        xsi:schemaLocation=&#34;ddieditor-lightobject ddieditor-lightxmlobject.xsd&#34;<br/&gt;        xmlns:rmd=&#34;http://dda.dk/ddi/result-metadata&#34;&amp;gt;<br/&gt;        {$search-parameters}<br/&gt;        &amp;lt;rmd:ResultMetaData<br/&gt;            result-count=&#34;{$result-count}&#34;<br/&gt;            hit-start=&#34;{$hit-start}&#34;<br/&gt;            hit-end=&#34;{$hit-end-corrected}&#34;<br/&gt;            hits-perpage=&#34;{$hits-perpage}&#34;<br/&gt;            number-of-pages=&#34;{$number-of-pages}&#34;<br/&gt;            current-page=&#34;{$current-page}&#34;/&amp;gt;<br/&gt;        {<br/&gt;        for $result in $results[position() = $hit-start to $hit-end]<br/&gt;            return <br/&gt;                if ($advanced) then<br/&gt;                    result:buildResultListItemAdvanced($result)<br/&gt;                else<br/&gt;                    result:buildResultListItem($result)<br/&gt;        }<br/&gt;    &amp;lt;/dl:LightXmlObjectList&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $results as element()* ,<br>&nbsp; $hits-perpage as xs:integer ,<br>&nbsp; $hit-start as xs:integer ,<br>&nbsp; $search-parameters as element() ,<br>&nbsp; $advanced as xs:boolean) as element()<br><br></li></ul><p> Makes a LightXmlObjectList element containing the info based on the result list</p><ul><li>Parameters:</li><ul><li>$results - the result list to process<br></li><li>$hits-perpage - the number of hits to be shown per page<br></li><li>$hit-start - number of the first hit to be shown on the page<br></li><li>$search-parameters - the original search parameters which are returned in the result element<br></li><li>$advanced - tells if we are performing an advanced search<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="2">http://dda.dk/ddi/result</td><td>buildResultListItem</td></tr><tr><td>buildResultListItemAdvanced</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="3">http://www.w3.org/2005/xpath-functions</td><td>ceiling</td></tr><tr><td>count</td></tr><tr><td>position</td></tr></table></div><div class="methoddetail"><h6>Internal Functions that invoke this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="2">http://dda.dk/ddi</td><td><a href="#advancedSearch">advancedSearch</a></td></tr><tr><td><a href="#simpleSearch">simpleSearch</a></td></tr></table></div></div>&nbsp;<div id="conditionalIntersection" class="methoddetail"><h5><a name="conditionalIntersection"></a>conditionalIntersection</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:conditionalIntersection($set1 as element()*, $required1 as xs:boolean,<br/&gt;                                               $set2 as element()*, $required2 as xs:boolean,<br/&gt;                                               $set3 as element()*, $required3 as xs:boolean,<br/&gt;                                               $set4 as element()*, $required4 as xs:boolean,<br/&gt;                                               $set5 as element()*, $required5 as xs:boolean,<br/&gt;                                               $set6 as element()*, $required6 as xs:boolean,<br/&gt;                                               $set7 as element()*, $required7 as xs:boolean) as node()*{<br/&gt;    let $union := local:idUnion($set1,<br/&gt;                  local:idUnion($set2,<br/&gt;                  local:idUnion($set3,<br/&gt;                  local:idUnion($set4,<br/&gt;                  local:idUnion($set5,<br/&gt;                  local:idUnion($set6, $set7))))))<br/&gt;    <br/&gt;    return<br/&gt;        local:idIntersect((if ($required1) then $set1 else $union),<br/&gt;        local:idIntersect((if ($required2) then $set2 else $union),<br/&gt;        local:idIntersect((if ($required3) then $set3 else $union),<br/&gt;        local:idIntersect((if ($required4) then $set4 else $union),<br/&gt;        local:idIntersect((if ($required5) then $set5 else $union),<br/&gt;        local:idIntersect((if ($required6) then $set6 else $union), (if ($required7) then $set7 else $union)))))))<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $set1 as element()* ,<br>&nbsp; $required1 as xs:boolean ,<br>&nbsp; $set2 as element()* ,<br>&nbsp; $required2 as xs:boolean ,<br>&nbsp; $set3 as element()* ,<br>&nbsp; $required3 as xs:boolean ,<br>&nbsp; $set4 as element()* ,<br>&nbsp; $required4 as xs:boolean ,<br>&nbsp; $set5 as element()* ,<br>&nbsp; $required5 as xs:boolean ,<br>&nbsp; $set6 as element()* ,<br>&nbsp; $required6 as xs:boolean ,<br>&nbsp; $set7 as element()* ,<br>&nbsp; $required7 as xs:boolean) as node()*<br><br></li></ul><p> Makes intersection only on lists which were requested by the search parameters</p><ul><li>Parameters:</li><ul><li>$set1-$set7 - the lists of elements<br></li><li>$required1-$required7 - spedifies if the corresponding list was required<br></li></ul></ul></div>&nbsp;<div id="getDdiStudy" class="methoddetail"><h5><a name="getDdiStudy"></a>getDdiStudy</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function ddi:getDdiStudy($studyId as xs:string) as element()*{<br/&gt;    let $study := collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(@id, $studyId)]<br/&gt;    return $study/ancestor::i:DDIInstance<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $studyId as xs:string) as element()*<br><br></li></ul><p> Makes a free-text search in StudyUnit elements and returns the element(s) containing the match It also sorts the list by score in descending order</p><ul><li>Parameters:</li><ul><li>$search-string - the string that needs to be matched<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="idIntersect" class="methoddetail"><h5><a name="idIntersect"></a>idIntersect</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:idIntersect($set1 as element()*, $set2 as element()*) as node()*{<br/&gt;    ($set1[@id = ($set2/@id)])<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $set1 as element()* ,<br>&nbsp; $set2 as element()*) as node()*<br><br></li></ul><p> Custom intersection function which operates on element id's</p><ul><li>Parameters:</li><ul><li>$set1 - the first set in the intersection<br></li><li>$set2 - the second set in the intersection<br></li></ul></ul></div>&nbsp;<div id="idUnion" class="methoddetail"><h5><a name="idUnion"></a>idUnion</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:idUnion($set1 as element()*, $set2 as element()*) as node()*{<br/&gt;    ($set1, $set2[every $element in $set1 satisfies $element/@id != ./@id])<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $set1 as element()* ,<br>&nbsp; $set2 as element()*) as node()*<br><br></li></ul><p> Custom union function which operates on element id's</p><ul><li>Parameters:</li><ul><li>$set1 - the first set in the union<br></li><li>$set2 - the second set in the union<br></li></ul></ul></div>&nbsp;<div id="listDdiStudies" class="methoddetail"><h5><a name="listDdiStudies"></a>listDdiStudies</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function ddi:listDdiStudies($lang as xs:string) as element()*{<br/&gt;    let $studies := for $result in collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit<br/&gt;    order by $result/r:Citation/r:Title[@xml:lang=$lang]<br/&gt;    return $result<br/&gt;    <br/&gt;   <br/&gt;    return &amp;lt;dl:LightXmlObjectList xmlns:dl=&#34;ddieditor-lightobject&#34;<br/&gt;        xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;<br/&gt;        xsi:schemaLocation=&#34;ddieditor-lightobject ddieditor-lightxmlobject.xsd&#34;<br/&gt;        xmlns:smd=&#34;http://dda.dk/ddi/search-metadata&#34;&amp;gt;<br/&gt;        { for $study in $studies return result:buildListStudyListItem($study) }<br/&gt;    &amp;lt;/dl:LightXmlObjectList&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $lang as xs:string) as element()*<br><br></li></ul><ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://dda.dk/ddi/result</td><td>buildListStudyListItem</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="lookupCategory" class="methoddetail"><h5><a name="lookupCategory"></a>lookupCategory</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function ddi:lookupCategory($categoryId as xs:string) as element(){<br/&gt;    let $category := collection(&amp;apos;/db/apps/dda&amp;apos;)//lp:Category[ft:query(@id, $categoryId)]<br/&gt;    return &amp;lt;dl:LightXmlObjectList xmlns:dl=&#34;ddieditor-lightobject&#34;<br/&gt;        xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;<br/&gt;        xsi:schemaLocation=&#34;ddieditor-lightobject ddieditor-lightxmlobject.xsd&#34;<br/&gt;        xmlns:smd=&#34;http://dda.dk/ddi/search-metadata&#34;&amp;gt;<br/&gt;            {result:buildResultListItem($category)}<br/&gt;    &amp;lt;/dl:LightXmlObjectList&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $categoryId as xs:string) as element()<br><br></li></ul><p> Searches for a Category and returns a LightXmlObjectList element with the result</p><ul><li>Parameters:</li><ul><li>$categoryId - the ID of the Category<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://dda.dk/ddi/result</td><td>buildResultListItem</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="lookupConcept" class="methoddetail"><h5><a name="lookupConcept"></a>lookupConcept</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function ddi:lookupConcept($conceptId as xs:string) as element(){<br/&gt;    let $concept := collection(&amp;apos;/db/apps/dda&amp;apos;)//cc:Concept[ft:query(@id, $conceptId)]<br/&gt;    return &amp;lt;dl:LightXmlObjectList xmlns:dl=&#34;ddieditor-lightobject&#34;<br/&gt;        xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;<br/&gt;        xsi:schemaLocation=&#34;ddieditor-lightobject ddieditor-lightxmlobject.xsd&#34;<br/&gt;        xmlns:smd=&#34;http://dda.dk/ddi/search-metadata&#34;&amp;gt;<br/&gt;            {result:buildResultListItem($concept)}<br/&gt;    &amp;lt;/dl:LightXmlObjectList&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $conceptId as xs:string) as element()<br><br></li></ul><p> Searches for a Concept and returns a LightXmlObjectList element with the result</p><ul><li>Parameters:</li><ul><li>$conceptId - the ID of the Concept<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://dda.dk/ddi/result</td><td>buildResultListItem</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="lookupMultipleQuestionItem" class="methoddetail"><h5><a name="lookupMultipleQuestionItem"></a>lookupMultipleQuestionItem</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function ddi:lookupMultipleQuestionItem($multipleQuestionItemId as xs:string) as element(){<br/&gt;    let $multipleQuestionItem := collection(&amp;apos;/db/apps/dda&amp;apos;)//dc:MultipleQuestionItem[ft:query(@id, $multipleQuestionItemId)]<br/&gt;    return &amp;lt;dl:LightXmlObjectList xmlns:dl=&#34;ddieditor-lightobject&#34;<br/&gt;        xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;<br/&gt;        xsi:schemaLocation=&#34;ddieditor-lightobject ddieditor-lightxmlobject.xsd&#34;<br/&gt;        xmlns:smd=&#34;http://dda.dk/ddi/search-metadata&#34;&amp;gt;<br/&gt;            {result:buildResultListItem($multipleQuestionItem)}<br/&gt;    &amp;lt;/dl:LightXmlObjectList&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $multipleQuestionItemId as xs:string) as element()<br><br></li></ul><p> Searches for a MultipleQuestionItem and returns a LightXmlObjectList element with the result</p><ul><li>Parameters:</li><ul><li>$multipleQuestionItemId - the ID of the MultipleQuestionItem<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://dda.dk/ddi/result</td><td>buildResultListItem</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="lookupQuestionItem" class="methoddetail"><h5><a name="lookupQuestionItem"></a>lookupQuestionItem</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function ddi:lookupQuestionItem($questionItemId as xs:string) as element(){<br/&gt;    let $questionItem := collection(&amp;apos;/db/apps/dda&amp;apos;)//dc:QuestionItem[ft:query(@id, $questionItemId)]<br/&gt;    return &amp;lt;dl:LightXmlObjectList xmlns:dl=&#34;ddieditor-lightobject&#34;<br/&gt;        xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;<br/&gt;        xsi:schemaLocation=&#34;ddieditor-lightobject ddieditor-lightxmlobject.xsd&#34;<br/&gt;        xmlns:smd=&#34;http://dda.dk/ddi/search-metadata&#34;&amp;gt;<br/&gt;            {result:buildResultListItem($questionItem)}<br/&gt;    &amp;lt;/dl:LightXmlObjectList&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $questionItemId as xs:string) as element()<br><br></li></ul><p> Searches for a QuestionItem and returns a LightXmlObjectList element with the result</p><ul><li>Parameters:</li><ul><li>$questionItemId - the ID of the QuestionItem<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://dda.dk/ddi/result</td><td>buildResultListItem</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="lookupUniverse" class="methoddetail"><h5><a name="lookupUniverse"></a>lookupUniverse</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function ddi:lookupUniverse($universeId as xs:string) as element(){<br/&gt;    let $universe := collection(&amp;apos;/db/apps/dda&amp;apos;)//cc:Universe[ft:query(@id, $universeId)]<br/&gt;    return &amp;lt;dl:LightXmlObjectList xmlns:dl=&#34;ddieditor-lightobject&#34;<br/&gt;        xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;<br/&gt;        xsi:schemaLocation=&#34;ddieditor-lightobject ddieditor-lightxmlobject.xsd&#34;<br/&gt;        xmlns:smd=&#34;http://dda.dk/ddi/search-metadata&#34;&amp;gt;<br/&gt;            {result:buildResultListItem($universe)}<br/&gt;    &amp;lt;/dl:LightXmlObjectList&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $universeId as xs:string) as element()<br><br></li></ul><p> Searches for a Universe and returns a LightXmlObjectList element with the result</p><ul><li>Parameters:</li><ul><li>$universeId - the ID of the Universe<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://dda.dk/ddi/result</td><td>buildResultListItem</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="lookupVariable" class="methoddetail"><h5><a name="lookupVariable"></a>lookupVariable</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function ddi:lookupVariable($variableId as xs:string) as element(){<br/&gt;    let $variable := collection(&amp;apos;/db/apps/dda&amp;apos;)//lp:Variable[ft:query(@id, $variableId)]<br/&gt;    return &amp;lt;dl:LightXmlObjectList xmlns:dl=&#34;ddieditor-lightobject&#34;<br/&gt;        xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;<br/&gt;        xsi:schemaLocation=&#34;ddieditor-lightobject ddieditor-lightxmlobject.xsd&#34;<br/&gt;        xmlns:smd=&#34;http://dda.dk/ddi/search-metadata&#34;&amp;gt;<br/&gt;            {result:buildResultListItem($variable)}<br/&gt;    &amp;lt;/dl:LightXmlObjectList&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $variableId as xs:string) as element()<br><br></li></ul><p> Searches for a Variable and returns a LightXmlObjectList element with the result</p><ul><li>Parameters:</li><ul><li>$variableId - the ID of the Variable<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://dda.dk/ddi/result</td><td>buildResultListItem</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="queryCategory" class="methoddetail"><h5><a name="queryCategory"></a>queryCategory</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:queryCategory($search-string as xs:string) as element()*{<br/&gt;    let $list :=<br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//lp:Category[ft:query(r:Label, $search-string)]<br/&gt;    for $element in $list<br/&gt;        order by ft:score($element) descending<br/&gt;        return $element<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><p> Makes a free-text search in Category elements and returns the element(s) containing the match It also sorts the list by score in descending order</p><ul><li>Parameters:</li><ul><li>$search-string - the string that needs to be matched<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="queryConcept" class="methoddetail"><h5><a name="queryConcept"></a>queryConcept</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:queryConcept($search-string as xs:string) as element()*{<br/&gt;    let $list :=<br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//cc:Concept[ft:query(r:Label, $search-string)] <br/&gt;        <br/&gt;    for $element in $list<br/&gt;        order by ft:score($element) descending<br/&gt;        return $element<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><p> Makes a free-text search in Concept elements and returns the element(s) containing the match It also sorts the list by score in descending order</p><ul><li>Parameters:</li><ul><li>$search-string - the string that needs to be matched<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="queryMultipleQuestionItem" class="methoddetail"><h5><a name="queryMultipleQuestionItem"></a>queryMultipleQuestionItem</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:queryMultipleQuestionItem($search-string as xs:string) as element()*{<br/&gt;    let $list :=<br/&gt;        <br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//dc:MultipleQuestionItem[ft:query(dc:QuestionText/dc:LiteralText/dc:Text, $search-string)]<br/&gt;    for $element in $list<br/&gt;        order by ft:score($element) descending<br/&gt;        return $element<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><p> Makes a free-text search in MultipleQuestionItem elements and returns the element(s) containing the match It also sorts the list by score in descending order</p><ul><li>Parameters:</li><ul><li>$search-string - the string that needs to be matched<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="queryQuestionItem" class="methoddetail"><h5><a name="queryQuestionItem"></a>queryQuestionItem</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:queryQuestionItem($search-string as xs:string) as element()*{<br/&gt;    let $list :=<br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//dc:QuestionItem[ft:query(dc:QuestionText/dc:LiteralText/dc:Text, $search-string)]<br/&gt;    for $element in $list<br/&gt;        order by ft:score($element) descending<br/&gt;        return $element<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><p> Makes a free-text search in QuestionItem elements and returns the element(s) containing the match It also sorts the list by score in descending order</p><ul><li>Parameters:</li><ul><li>$search-string - the string that needs to be matched<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="queryStudyUnit" class="methoddetail"><h5><a name="queryStudyUnit"></a>queryStudyUnit</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:queryStudyUnit($search-string as xs:string) as element()*{<br/&gt;    let $list :=<br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(@id, $search-string)] |<br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(r:Citation/r:Creator, $search-string)] |<br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(r:Citation/r:Title, $search-string)] |<br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(r:Coverage/r:TopicalCoverage/r:Keyword, $search-string)] |<br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(r:Coverage/r:TopicalCoverage/r:Subject, $search-string)] | <br/&gt;        <br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(su:Abstract/r:Content, $search-string)] |<br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(su:Purpose/r:Content, $search-string)] <br/&gt;        <br/&gt;    for $element in $list<br/&gt;        order by ft:score($element) descending<br/&gt;        return $element<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><p> Makes a free-text search in StudyUnit elements and returns the element(s) containing the match It also sorts the list by score in descending order</p><ul><li>Parameters:</li><ul><li>$search-string - the string that needs to be matched<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="queryUniverse" class="methoddetail"><h5><a name="queryUniverse"></a>queryUniverse</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:queryUniverse($search-string as xs:string) as element()*{<br/&gt;    let $list :=<br/&gt;        <br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//cc:Universe[ft:query(cc:HumanReadable, $search-string)]<br/&gt;    for $element in $list<br/&gt;        order by ft:score($element) descending<br/&gt;        return $element<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><p> Makes a free-text search in Universe elements and returns the element(s) containing the match It also sorts the list by score in descending order</p><ul><li>Parameters:</li><ul><li>$search-string - the string that needs to be matched<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="queryVariable" class="methoddetail"><h5><a name="queryVariable"></a>queryVariable</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:queryVariable($search-string as xs:string) as element()*{<br/&gt;    let $list :=<br/&gt;        <br/&gt;        collection(&amp;apos;/db/apps/dda&amp;apos;)//lp:Variable[ft:query(r:Label, $search-string)]<br/&gt;    for $element in $list<br/&gt;        order by ft:score($element) descending<br/&gt;        return $element<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-string as xs:string) as element()*<br><br></li></ul><p> Makes a free-text search in Variable elements and returns the element(s) containing the match It also sorts the list by score in descending order</p><ul><li>Parameters:</li><ul><li>$search-string - the string that needs to be matched<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr></table></div></div>&nbsp;<div id="simpleSearch" class="methoddetail"><h5><a name="simpleSearch"></a>simpleSearch</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function ddi:simpleSearch($search-parameters as element()) as element(){<br/&gt;    let $search-string := data($search-parameters/ssp:search-string)<br/&gt;    let $search-metadata := $search-parameters/smd:SearchMetaData<br/&gt;    let $search-scope := $search-parameters/s:Scope<br/&gt;<br/&gt;    <br/&gt;    let $studyUnitScope := if ($search-scope/s:StudyUnit) then local:queryStudyUnit($search-string) else ()<br/&gt;    let $conceptScope := if ($search-scope/s:Concept) then local:queryConcept($search-string) else ()<br/&gt;    let $universeScope := if ($search-scope/s:Universe) then local:queryUniverse($search-string) else ()<br/&gt;    let $questionItemScope := if ($search-scope/s:QuestionItem) then local:queryQuestionItem($search-string) else ()<br/&gt;    let $multipleQuestionItemScope := if ($search-scope/s:MultipleQuestionItem) then local:queryMultipleQuestionItem($search-string) else ()<br/&gt;    let $variableScope := if ($search-scope/s:Variable) then local:queryVariable($search-string) else ()<br/&gt;    let $categoryScope := if ($search-scope/s:Category) then local:queryCategory($search-string) else ()<br/&gt;    <br/&gt;    let $results :=<br/&gt;    (<br/&gt;        $studyUnitScope            ,<br/&gt;        $conceptScope              ,<br/&gt;        $universeScope             ,<br/&gt;        $questionItemScope         ,<br/&gt;        $multipleQuestionItemScope ,<br/&gt;        $variableScope             ,<br/&gt;        $categoryScope<br/&gt;    )<br/&gt;<br/&gt;    return ddi:buildLightXmlObjectList($results, data($search-metadata/@hits-perpage), data($search-metadata/@hit-start), $search-parameters, false())<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-parameters as element()) as element()<br><br></li></ul><p> Makes a free-text search in all indexed elements and returns a list of LightXmlObject elements with the results</p><ul><li>Parameters:</li><ul><li>$search-parameters - the search parameters wrapped in a SimpleSearchParameters element with the following format:  <br xmlns:xqdoc="http://www.xqdoc.org/1.0">   <pre xmlns:xqdoc="http://www.xqdoc.org/1.0">&lt;ssp:SimpleSearchParameters xmlns:smd="http://dda.dk/ddi/search-metadata"<br> xmlns:ssp="http://dda.dk/ddi/simple-search-parameters"<br> xmlns:s="http://dda.dk/ddi/scope"<br> xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;<br>    &lt;ssp:search-string&gt;some text&lt;/ssp:search-string&gt;        &lt;!-- The text we are searching for (xs:string). Required. --&gt;<br>    &lt;smd:SearchMetaData hits-perpage="10" hit-start="0"/&gt;         &lt;!-- The number of hits we wish to show per page (xs:positiveInteger) and the number of the first result we wish to get (xs:nonNegativeInteger). Both required. --&gt;<br>    &lt;s:Scope&gt;                                                     &lt;!-- The scope of our search. Each child-element is optional and if it is present the search will return results of the type specified by that element (if found). The child-elements have no type or content; only the existence is checked. --&gt;<br>        &lt;s:StudyUnit/&gt;<br>        &lt;s:Variable/&gt;<br>        &lt;s:QuestionItem/&gt;<br>        &lt;s:MultipleQuestionItem/&gt;<br>        &lt;s:Universe/&gt;<br>        &lt;s:Concept/&gt;<br>        &lt;s:Category/&gt;<br>    &lt;/s:Scope&gt;<br>&lt;/ssp:SimpleSearchParameters&gt;<br></pre>    With this function it is not possible to set the reference scope, i.e. the list of types we wish to return references to. It sends results to processing with an empty scope resulting in the default list being used, which is:   <pre xmlns:xqdoc="http://www.xqdoc.org/1.0">  For Variable:              &lt;s:Scope&gt;&lt;s:QuestionItem/&gt;&lt;s:MultipleQuestionItem/&gt;&lt;s:Universe/&gt;&lt;s:Concept/&gt;&lt;s:Category/&gt;&lt;s:RepresentationType/&gt;&lt;/s:Scope&gt;<br>  For QuestionItem:          &lt;s:Scope&gt;&lt;s:Variable/&gt;&lt;s:Universe/&gt;&lt;s:Concept/&gt;&lt;s:Category/&gt;&lt;s:DomainType/&gt;&lt;/s:Scope&gt;<br>  For MultipleQuestionItem:  &lt;s:Scope&gt;&lt;s:Variable/&gt;&lt;s:Universe/&gt;&lt;s:Concept/&gt;&lt;s:Category/&gt;&lt;/s:Scope&gt;<br>  For Universe:              &lt;s:Scope&gt;&lt;s:Variable/&gt;&lt;/s:Scope&gt;<br>  For Concept:               &lt;s:Scope&gt;&lt;s:Variable/&gt;&lt;s:QuestionItem/&gt;&lt;s:MultipleQuestionItem/&gt;&lt;/s:Scope&gt;<br>  For Category:              &lt;s:Scope&gt;&lt;s:Variable/&gt;&lt;s:QuestionItem/&gt;&lt;s:MultipleQuestionItem/&gt;&lt;/s:Scope&gt;<br></pre>     <br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="2">http://www.w3.org/2005/xpath-functions</td><td>data</td></tr><tr><td>false</td></tr></table></div><div class="methoddetail"><h6>Internal Functions used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://dda.dk/ddi</td><td><a href="#buildLightXmlObjectList">buildLightXmlObjectList</a></td></tr></table></div></div>&nbsp;<div id="studyUnitsFromParameters" class="methoddetail"><h5><a name="studyUnitsFromParameters"></a>studyUnitsFromParameters</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function local:studyUnitsFromParameters($search-parameters as element()) as element()*{<br/&gt;    <br/&gt;    <br/&gt;    <br/&gt;    let $studyFromId :=<br/&gt;        if($search-parameters/asp:studyId) then<br/&gt;            let $studyId := string($search-parameters/asp:studyId)<br/&gt;            return collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(@id, $studyId)] else ()<br/&gt;    let $studyFromTitle :=<br/&gt;        if($search-parameters/asp:title) then<br/&gt;            let $studyTitle := string($search-parameters/asp:title)<br/&gt;            return collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(r:Citation/r:Title, $studyTitle)] else ()<br/&gt;    let $studyFromTopicalCoverage :=<br/&gt;        if($search-parameters/asp:topicalCoverage) then<br/&gt;            let $studyTopicalCoverage := string($search-parameters/asp:topicalCoverage)<br/&gt;            return collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(r:Coverage/r:TopicalCoverage/r:Keyword, $studyTopicalCoverage)] <br/&gt;            | collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(r:Coverage/r:TopicalCoverage/r:Subject, $studyTopicalCoverage)] else ()<br/&gt;    let $studyFromSpatialCoverage :=<br/&gt;        if($search-parameters/asp:spatialCoverage) then<br/&gt;            let $studySpatialCoverage := string($search-parameters/asp:spatialCoverage)<br/&gt;            return collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(r:Coverage/r:SpatialCoverage/r:TopLevelReference/r:LevelName, $studySpatialCoverage)] else ()<br/&gt;    let $studyFromAbstractPurpose :=<br/&gt;        if($search-parameters/asp:abstract-purpose) then<br/&gt;            let $studyAbstractPurpose := string($search-parameters/asp:abstract-purpose)<br/&gt;            return collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(su:Abstract/r:Content, $studyAbstractPurpose)] | <br/&gt;                   collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(su:Purpose/r:Content, $studyAbstractPurpose)] else ()<br/&gt;    let $studyFromCreator :=<br/&gt;        if($search-parameters/asp:creator) then<br/&gt;            let $studyCreator := string($search-parameters/asp:creator)<br/&gt;            return collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(r:Citation/r:Creator, $studyCreator)] else ()<br/&gt;    let $studyFromKindOfData :=<br/&gt;        if($search-parameters/asp:kindOfData) then<br/&gt;            let $studyKindOfData := string($search-parameters/asp:kindOfData)<br/&gt;            return collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[ft:query(su:KindOfData, $studyKindOfData)] else ()<br/&gt;    let $studyFromTemporalCoverage :=<br/&gt;        <br/&gt;        if($search-parameters/asp:coverageFrom) then<br/&gt;            let $studyFrom := dateTime($search-parameters/asp:coverageFrom, xs:time(&amp;apos;00:00:00.000+01:00&amp;apos;))<br/&gt;            <br/&gt;            return if($search-parameters/asp:coverageTo) then<br/&gt;                let $studyTo := dateTime($search-parameters/asp:coverageTo, xs:time(&amp;apos;00:00:00.000+01:00&amp;apos;))<br/&gt;                return collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[r:Coverage/r:TemporalCoverage/r:ReferenceDate/r:StartDate ge $studyFrom and r:Coverage/r:TemporalCoverage/r:ReferenceDate/r:EndDate le $studyTo] <br/&gt;            <br/&gt;            else<br/&gt;                collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[r:Coverage/r:TemporalCoverage/r:ReferenceDate/r:StartDate ge $studyFrom]<br/&gt;        <br/&gt;        else<br/&gt;            <br/&gt;            if($search-parameters/asp:coverageTo) then<br/&gt;                let $studyTo := dateTime($search-parameters/asp:coverageTo, xs:time(&amp;apos;00:00:00.000+01:00&amp;apos;))<br/&gt;                return collection(&amp;apos;/db/apps/dda&amp;apos;)//su:StudyUnit[r:Coverage/r:TemporalCoverage/r:ReferenceDate/r:EndDate le $studyTo]<br/&gt;            else ()<br/&gt;    <br/&gt;    let $studyUnitUnion :=<br/&gt;        $studyFromId               |<br/&gt;        $studyFromTitle            |<br/&gt;        $studyFromTopicalCoverage  |<br/&gt;        $studyFromSpatialCoverage  |<br/&gt;        $studyFromAbstractPurpose  |<br/&gt;        $studyFromCreator          |<br/&gt;        $studyFromKindOfData       |<br/&gt;        $studyFromTemporalCoverage<br/&gt;    <br/&gt;    <br/&gt;    return<br/&gt;        (if ($studyFromId) then $studyFromId else $studyUnitUnion)                            intersect<br/&gt;        (if ($studyFromTitle) then $studyFromTitle else $studyUnitUnion)                      intersect<br/&gt;        (if ($studyFromTopicalCoverage) then $studyFromTopicalCoverage else $studyUnitUnion)  intersect<br/&gt;        (if ($studyFromSpatialCoverage) then $studyFromSpatialCoverage else $studyUnitUnion)  intersect<br/&gt;        (if ($studyFromAbstractPurpose) then $studyFromAbstractPurpose else $studyUnitUnion)  intersect<br/&gt;        (if ($studyFromCreator) then $studyFromCreator else $studyUnitUnion)                  intersect<br/&gt;        (if ($studyFromKindOfData) then $studyFromKindOfData else $studyUnitUnion)            intersect<br/&gt;        (if ($studyFromTemporalCoverage) then $studyFromTemporalCoverage else $studyUnitUnion)<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-parameters as element()) as element()*<br><br></li></ul><p> Finds studies based on advanced search parameters</p><ul><li>Parameters:</li><ul><li>$search-parameters - the advanced search parameters<br></li></ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="3">http://www.w3.org/2005/xpath-functions</td><td>collection</td></tr><tr><td>dateTime</td></tr><tr><td>string</td></tr></table></div></div>&nbsp;</div>&nbsp;<div align="left"><i>Created by xqDoc-Lite version 1.0 on Fri Nov 29 01:24:21 CET 2013</i></div></body></html>